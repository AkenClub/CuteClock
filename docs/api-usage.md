# ğŸ”Œ HTTP API ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨ CuteClock çš„ HTTP API æ¥å£æ§åˆ¶è®¾å¤‡ã€‚

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### API å¯†é’¥ä¿æŠ¤

ï¼ˆå›ºä»¶è®¾ç½®çš„å¯†é’¥ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œä¸è¿›è¡Œå¯†é’¥éªŒè¯ï¼‰

- **å¯é€‰çš„æ¥å£ä¿æŠ¤**ï¼šæˆ¿é—´ç¯å…‰ã€æ—¶é’Ÿäº®åº¦ã€ç”µè„‘ç”µæºç­‰æ•æ„Ÿæ¥å£æ”¯æŒ API å¯†é’¥éªŒè¯ã€‚
- **è·³è¿‡éªŒè¯**ï¼šåœ¨å›ºä»¶çš„ `UserConfig.h` ä¸­å°† `UserHttpApiKey` è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸² (`""`)ï¼Œå¯ä»¥è·³è¿‡æ‰€æœ‰æ¥å£çš„å¯†é’¥éªŒè¯ï¼Œæ–¹ä¾¿åœ¨å—ä¿¡ä»»çš„å†…ç½‘ç¯å¢ƒä¸­è¿›è¡Œè°ƒè¯•æˆ–ä½¿ç”¨ã€‚
- **è¯·æ±‚å¤´éªŒè¯**ï¼šå¯ç”¨å¯†é’¥æ—¶ï¼Œä½¿ç”¨ `X-API-Key` è¯·æ±‚å¤´ä¼ é€’å¯†é’¥ã€‚

### å®‰å…¨å»ºè®®

- âœ… **å†…ç½‘éƒ¨ç½²**ï¼šæ— è®ºæ˜¯å¦å¯ç”¨å¯†é’¥ï¼Œéƒ½å¼ºçƒˆå»ºè®®åœ¨å†…ç½‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé¿å…å°†è®¾å¤‡æš´éœ²åˆ°å…¬ç½‘ã€‚
- âœ… **è®¿é—®æ§åˆ¶**ï¼šé€šè¿‡è·¯ç”±å™¨ç­‰è®¾å¤‡é™åˆ¶åªæœ‰å¯ä¿¡çš„è®¾å¤‡å¯ä»¥è®¿é—®ã€‚

### æ¥å£æƒé™è¯´æ˜

| æ¥å£          | è®¿é—®æƒé™          | ç”¨é€”              |
| ------------- | ----------------- | ----------------- |
| `/`           | ğŸŸ¢ å…¬å¼€           | å†…ç½® Web æ§åˆ¶é¢æ¿ |
| `/all-status` | ğŸŸ¢ å…¬å¼€           | æŸ¥çœ‹è®¾å¤‡çŠ¶æ€      |
| `/room-light` | ğŸ” å¯é…ç½®å¯†é’¥éªŒè¯ | æ§åˆ¶æˆ¿é—´ç¯å…‰      |
| `/clock`      | ğŸ” å¯é…ç½®å¯†é’¥éªŒè¯ | è°ƒèŠ‚æ—¶é’Ÿäº®åº¦      |
| `/pc-power`   | ğŸ” å¯é…ç½®å¯†é’¥éªŒè¯ | æ§åˆ¶ç”µè„‘ç”µæº      |

## ğŸ” API å®‰å…¨è®¤è¯

### å¯†é’¥é…ç½®

åœ¨å¼€å§‹ä½¿ç”¨ API ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²åœ¨ `UserConfig.h` æ–‡ä»¶ä¸­é…ç½®äº†æ‚¨çš„ API å¯†é’¥ï¼š

```cpp
#define UserHttpApiKey "your_unique_api_key_here"
```

**é‡è¦æç¤ºï¼š**

- **è®¾ç½®å”¯ä¸€å¯†é’¥**ï¼šä¸ºäº†å®‰å…¨ï¼Œå»ºè®®è®¾ç½®ä¸€ä¸ªå”¯ä¸€çš„ API å¯†é’¥ï¼Œä¸è¦ä½¿ç”¨é»˜è®¤å€¼ã€‚
- **ç¦ç”¨è®¤è¯**ï¼šå¦‚æœæ‚¨åœ¨å®Œå…¨å—ä¿¡ä»»çš„å†…éƒ¨ç½‘ç»œä¸­ä½¿ç”¨ï¼Œå¯ä»¥å°†æ­¤å¯†é’¥è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸² (`""`) æ¥ç¦ç”¨è®¤è¯ï¼Œä»è€Œç®€åŒ– API è°ƒç”¨ã€‚
- **å¯†é’¥ä¿å¯†**ï¼šä¸è¦å°†å¯†é’¥æ³„éœ²ç»™ä»–äººã€‚
- **Web UI**ï¼šå†…ç½® Web æ§åˆ¶é¢æ¿éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥å¯†é’¥ï¼ˆå¦‚æœå·²è®¾ç½®ï¼‰ã€‚

### ä½¿ç”¨æ–¹æ³•

å¯¹äºéœ€è¦è®¤è¯çš„æ¥å£ï¼ˆå³ `UserHttpApiKey` éç©ºæ—¶ï¼‰ï¼Œåœ¨ HTTP è¯·æ±‚å¤´ä¸­åŠ å…¥ï¼š

```
X-API-Key: your_api_key_here
```

å¦‚æœè®¤è¯è¢«ç¦ç”¨ï¼Œåˆ™æ— éœ€æ·»åŠ æ­¤è¯·æ±‚å¤´ã€‚

## ğŸ“¡ API æ¥å£è¯¦æƒ…

### åŸºç¡€ä¿¡æ¯

- **æœåŠ¡å™¨åœ°å€**: `http://è®¾å¤‡IPåœ°å€:ç«¯å£å·`
- **é»˜è®¤ç«¯å£**: `1229`ï¼ˆå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼‰
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

## ğŸ›ï¸ æ¥å£åˆ—è¡¨

### 1. è®¾å¤‡çŠ¶æ€æ£€æµ‹

**ç®€å•çš„åœ¨çº¿çŠ¶æ€æ£€æµ‹æ¥å£**

- **URL**: `/`
- **æ–¹æ³•**: `GET`
- **è®¤è¯**: æ— éœ€å¯†é’¥
- **å‚æ•°**: æ— 

**ç¤ºä¾‹è¯·æ±‚:**

```bash
curl http://192.168.1.100:1229/
```

**å“åº”:**

```
è¿”å›å†…ç½® Web æ§åˆ¶é¢æ¿
```

---

### 2. è·å–è®¾å¤‡çŠ¶æ€

**è·å–è®¾å¤‡å®Œæ•´çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬æˆ¿é—´ç¯å…‰ã€æ—¶é’Ÿæ˜¾ç¤ºã€æ¸©åº¦ä¼ æ„Ÿå™¨ç­‰è®¾å¤‡çŠ¶æ€**

- **URL**: `/all-status`
- **æ–¹æ³•**: `GET`
- **è®¤è¯**: æ— éœ€å¯†é’¥
- **å‚æ•°**: æ— 

**è®¾å¤‡ç±»å‹è¯´æ˜:**

| ç±»å‹          | æè¿°           | æ•°æ®å­—æ®µ                                                                             |
| ------------- | -------------- | ------------------------------------------------------------------------------------ |
| `light`       | æˆ¿é—´ç¯å…‰çŠ¶æ€   | `enable`: æ˜¯å¦å¼€å¯ (boolean)                                                         |
| `clock`       | æ—¶é’Ÿæ˜¾ç¤ºçŠ¶æ€   | `enable`: æ˜¯å¦å¯ç”¨ (boolean)<br>`brightness`: äº®åº¦ç­‰çº§ <br>`mode`: æ˜¾ç¤ºæ¨¡å¼ (number) |
| `pc`          | ç”µè„‘è®¾å¤‡çŠ¶æ€   | `enable`: æ˜¯å¦å¯ç”¨ (boolean)<br>`description`: åŠŸèƒ½æè¿° (string)                     |
| `temperature` | æ¸©åº¦ä¼ æ„Ÿå™¨æ•°æ® | `value`: æ¸©åº¦å€¼ (number)<br>`unit`: æ¸©åº¦å•ä½ (string, "Â°C")                          |

**ç¤ºä¾‹è¯·æ±‚:**

```bash
curl http://192.168.1.100:1229/all-status
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "errCode": 0,
  "errMsg": "è·å–æˆåŠŸ",
  "data": {
    "id": "esp8266-bedroom-01",
    "order": "RESPONSE_ALL_STATUS",
    "items": [
      {
        "type": "light",
        "id": "light-bedroom-01",
        "mark": "å§å®¤å¤§ç¯",
        "data": {
          "enable": true
        }
      },
      {
        "type": "clock",
        "id": "clock-living_room-01",
        "mark": "å®¢å…æ—¶é’Ÿ",
        "data": {
          "enable": true,
          "brightness": 5,
          "mode": 1
        }
      },
      {
        "type": "pc",
        "id": "pc-desktop-01",
        "mark": "å°å¼ç”µè„‘",
        "data": {
          "enable": true,
          "description": "ç”µæºå¼€å…³æ§åˆ¶"
        }
      },
      {
        "type": "temperature",
        "id": "temperature-sensor-01",
        "mark": "å®¤å†…æ¸©åº¦",
        "data": {
          "value": 24.5,
          "unit": "Â°C"
        }
      }
    ]
  }
}
```

---

### 3. æ§åˆ¶æˆ¿é—´ç¯å…‰

**æ§åˆ¶æˆ¿é—´ç¯å…·çš„å¼€å…³çŠ¶æ€**

- **URL**: `/room-light`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: ğŸ” **å¯é…ç½®å¯†é’¥éªŒè¯**
- **Content-Type**: `application/json`

**è¯·æ±‚å‚æ•°:**

```json
{
  "id": "light-bedroom-01",
  "order": {
    "type": "enable",
    "value": "on" // "on" æˆ– "off"
  }
}
```

**ç¤ºä¾‹è¯·æ±‚:**

```bash
# å¼€ç¯
curl -X POST http://192.168.1.100:1229/room-light \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "light-bedroom-01",
    "order": {
      "type": "enable",
      "value": "on"
    }
  }'

# å…³ç¯
curl -X POST http://192.168.1.100:1229/room-light \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "light-bedroom-01",
    "order": {
      "type": "enable",
      "value": "off"
    }
  }'
```

**æˆåŠŸå“åº”:**

```json
{
  "errCode": 0,
  "errMsg": "æˆåŠŸ"
}
```

---

### 4. è°ƒèŠ‚æ—¶é’Ÿäº®åº¦

**è°ƒèŠ‚ LED æ˜¾ç¤ºå±çš„äº®åº¦çº§åˆ«**

- **URL**: `/clock`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: ğŸ” **å¯é…ç½®å¯†é’¥éªŒè¯**
- **Content-Type**: `application/json`

**è¯·æ±‚å‚æ•°:**

```json
{
  "id": "clock-living_room-01",
  "order": {
    "type": "brightness",
    "value": 5
  }
}
```

**ç¤ºä¾‹è¯·æ±‚:**

```bash
# è®¾ç½®ä¸ºä¸­ç­‰äº®åº¦
curl -X POST http://192.168.1.100:1229/clock \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "clock-living_room-01",
    "order": {
      "type": "brightness",
      "value": 8
    }
  }'
```

**æˆåŠŸå“åº”:**

```json
{
  "errCode": 0,
  "errMsg": "æˆåŠŸ"
}
```

---

### 5. æ§åˆ¶ç”µè„‘ç”µæº

**æ¨¡æ‹ŸæŒ‰ä¸‹ç”µè„‘ç”µæºå¼€å…³æŒ‰é’®**

- **URL**: `/pc-power`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: ğŸ” **å¯é…ç½®å¯†é’¥éªŒè¯**
- **Content-Type**: `application/json`

**åŠŸèƒ½è¯´æ˜:**

- **æ— çŠ¶æ€æ£€æµ‹**ï¼šæ— æ³•åˆ¤æ–­ç”µè„‘å½“å‰æ˜¯å¼€æœºè¿˜æ˜¯å…³æœºçŠ¶æ€
- **å·¥ä½œåŸç†**ï¼šæ¨¡æ‹Ÿäººæ‰‹æŒ‰ä¸‹ç”µè„‘ç”µæºå¼€å…³æŒ‰é’®
- **å®é™…æ•ˆæœ**ï¼š
  - å¦‚æœç”µè„‘å¤„äºå…³æœºçŠ¶æ€ï¼Œè°ƒç”¨æ¥å£ä¼šå¼€æœº
  - å¦‚æœç”µè„‘å¤„äºå¼€æœºçŠ¶æ€ï¼Œè°ƒç”¨æ¥å£ä¼šè§¦å‘å…³æœº/ä¼‘çœ 
  - ç›¸å½“äºç‰©ç†æŒ‰ä¸‹ç”µæºå¼€å…³çš„æ•ˆæœ

**ç¤ºä¾‹è¯·æ±‚:**

```bash
# è§¦å‘ç”µè„‘ç”µæºå¼€å…³
curl -X POST http://192.168.1.100:1229/pc-power \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json"
```

**æˆåŠŸå“åº”:**

```json
{
  "errCode": 0,
  "errMsg": "æˆåŠŸ"
}
```

**âš ï¸ é‡è¦æç¤ºï¼š**

- æ­¤æ¥å£ä¸éœ€è¦è¯·æ±‚å‚æ•°
- æ¯æ¬¡è°ƒç”¨éƒ½ä¼šå‘é€ 500 æ¯«ç§’çš„ç”µæºè„‰å†²ä¿¡å·
- å»ºè®®é¿å…é¢‘ç¹è°ƒç”¨ï¼Œç»™ç”µè„‘è¶³å¤Ÿçš„å“åº”æ—¶é—´

## âŒ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜       | è§£å†³æ–¹æ³•              |
| ------ | ---------- | --------------------- |
| `-1`   | é€šç”¨é”™è¯¯   | æ£€æŸ¥è¯·æ±‚å‚æ•°å’Œæ ¼å¼    |
| `401`  | è®¤è¯å¤±è´¥   | æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æ­£ç¡® |
| `404`  | æ¥å£ä¸å­˜åœ¨ | æ£€æŸ¥è¯·æ±‚è·¯å¾„æ˜¯å¦æ­£ç¡®  |

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "errCode": -1,
  "errMsg": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

### å¸¸è§é”™è¯¯ç¤ºä¾‹

**ç¼ºå°‘ API å¯†é’¥:**

```json
{
  "errCode": -1,
  "errMsg": "ç¼ºå°‘APIå¯†é’¥"
}
```

**API å¯†é’¥æ— æ•ˆ:**

```json
{
  "errCode": -1,
  "errMsg": "APIå¯†é’¥æ— æ•ˆ"
}
```

**å‚æ•°æ ¼å¼é”™è¯¯:**

```json
{
  "errCode": -1,
  "errMsg": "æ—¶é’ŸçŠ¶æ€è§£æå¤±è´¥æˆ–è®¾ç½®å€¼éæ³•"
}
```

## ğŸ§ª æµ‹è¯•å·¥å…·æ¨è

### 1. curl (å‘½ä»¤è¡Œ)

é€‚åˆè„šæœ¬è‡ªåŠ¨åŒ–å’Œå¿«é€Ÿæµ‹è¯•

```bash
curl -X POST http://è®¾å¤‡IP:1229/room-light \
  -H "X-API-Key: your_key" \
  -H "Content-Type: application/json" \
  -d '{"id":"light-bedroom-01","order":{"type":"enable","value":"on"}}'
```

### 2. Postman (å›¾å½¢ç•Œé¢)

1. æ–°å»º POST è¯·æ±‚
2. URL: `http://è®¾å¤‡IP:1229/room-light`
3. Headers æ·»åŠ :
   - `X-API-Key`: `your_api_key`
   - `Content-Type`: `application/json`
4. Body é€‰æ‹© raw/JSONï¼Œè¾“å…¥è¯·æ±‚å‚æ•°

### 3. JavaScript (ç½‘é¡µ/Node.js)

```javascript
const response = await fetch("http://è®¾å¤‡IP:1229/room-light", {
  method: "POST",
  headers: {
    "X-API-Key": "your_api_key",
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    id: "light-bedroom-01",
    order: {
      type: "enable",
      value: "on",
    },
  }),
});

const result = await response.json();
console.log(result);
```

### 4. Python

```python
import requests

# æ§åˆ¶æˆ¿é—´ç¯å…‰
url = 'http://è®¾å¤‡IP:1229/room-light'
headers = {
    'X-API-Key': 'your_api_key',
    'Content-Type': 'application/json'
}
data = {
    'id': 'light-bedroom-01',
    'order': {
        'type': 'enable',
        'value': 'on'
    }
}

response = requests.post(url, headers=headers, json=data)
print(response.json())

# æ§åˆ¶ç”µè„‘ç”µæº
pc_url = 'http://è®¾å¤‡IP:1229/pc-power'
pc_response = requests.post(pc_url, headers=headers)
print(pc_response.json())
```

## ğŸ”§ æ•…éšœæ’é™¤

### è¿æ¥é—®é¢˜

1. **ç¡®è®¤è®¾å¤‡åœ¨çº¿**: è®¿é—® `/` æ¥å£æ£€æŸ¥è®¾å¤‡çŠ¶æ€
2. **æ£€æŸ¥ç½‘ç»œ**: ç¡®ä¿è®¾å¤‡å’Œå®¢æˆ·ç«¯åœ¨åŒä¸€ç½‘ç»œ
3. **ç«¯å£æ£€æŸ¥**: ç¡®è®¤ç«¯å£å·é…ç½®æ­£ç¡®ï¼ˆé»˜è®¤ 1229ï¼‰

### è®¤è¯é—®é¢˜

1. **æ£€æŸ¥å¯†é’¥**: ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­çš„å¯†é’¥ä¸è¯·æ±‚å¤´ä¸­çš„å¯†é’¥ä¸€è‡´ã€‚
2. **ç¡®è®¤æ˜¯å¦ç¦ç”¨**: æ£€æŸ¥å›ºä»¶ä¸­çš„ `UserHttpApiKey` æ˜¯å¦è¢«è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸² `""`ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ‰€æœ‰æ¥å£éƒ½ä¸éœ€è¦å¯†é’¥ã€‚
3. **è¯·æ±‚å¤´æ ¼å¼**: ç¡®ä¿ä½¿ç”¨ `X-API-Key` è€Œä¸æ˜¯å…¶ä»–åç§°ã€‚
4. **å¯†é’¥å­—ç¬¦**: æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦æˆ–ç©ºæ ¼ã€‚

### å‚æ•°é—®é¢˜

1. **JSON æ ¼å¼**: ä½¿ç”¨ JSON æ ¼å¼éªŒè¯å·¥å…·æ£€æŸ¥å‚æ•°æ ¼å¼
2. **å‚æ•°å€¼**: ç¡®è®¤å‚æ•°å€¼åœ¨æœ‰æ•ˆèŒƒå›´å†…
3. **Content-Type**: ç¡®ä¿è®¾ç½®äº†æ­£ç¡®çš„ Content-Type å¤´

---

**æ›´å¤šå¸®åŠ©è¯·å‚è€ƒï¼š**

- ğŸ“– [é…ç½®æ–‡ä»¶è¯´æ˜](configuration.md)
- ğŸ  [ç¡¬ä»¶æ­å»ºæŒ‡å—](hardware-setup.md)
- ğŸ’» [è½¯ä»¶é…ç½®æŒ‡å—](software-setup.md)
