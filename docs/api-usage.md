# ğŸ”Œ HTTP API ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨ CuteClock çš„ HTTP API æ¥å£æ§åˆ¶è®¾å¤‡ã€‚

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### API å¯†é’¥ä¿æŠ¤

- **æ•æ„Ÿæ¥å£ä¿æŠ¤**ï¼šæˆ¿é—´ç¯å…‰æ§åˆ¶å’Œæ—¶é’Ÿäº®åº¦è°ƒèŠ‚æ¥å£éœ€è¦ API å¯†é’¥éªŒè¯
- **è¯·æ±‚å¤´éªŒè¯**ï¼šä½¿ç”¨ `X-API-Key` è¯·æ±‚å¤´ä¼ é€’å¯†é’¥
- **çµæ´»é…ç½®**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ API å¯†é’¥ï¼Œä¸é…å¥—å°ç¨‹åº/Web é¡¹ç›®å¯¹åº”

### å®‰å…¨å»ºè®®

- âœ… **å†…ç½‘éƒ¨ç½²**ï¼šå»ºè®®åœ¨å†…ç½‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé¿å…æš´éœ²åˆ°å…¬ç½‘
- âœ… **å¯†é’¥åŒæ­¥**ï¼šå¦‚éœ€ä¿®æ”¹é»˜è®¤å¯†é’¥ï¼Œè¯·åŒæ­¥æ›´æ–°é…å¥—çš„å°ç¨‹åºå’Œ Web é¡¹ç›®
- âœ… **è®¿é—®æ§åˆ¶**ï¼šé™åˆ¶å¯ä¿¡è®¾å¤‡è®¿é—®

### æ¥å£æƒé™è¯´æ˜

| æ¥å£          | è®¿é—®æƒé™    | ç”¨é€”         |
| ------------- | ----------- | ------------ |
| `/`           | ğŸŸ¢ å…¬å¼€     | è®¾å¤‡çŠ¶æ€æ£€æµ‹ |
| `/all-status` | ğŸŸ¢ å…¬å¼€     | æŸ¥çœ‹è®¾å¤‡çŠ¶æ€ |
| `/room-light` | ğŸ” éœ€è¦å¯†é’¥ | æ§åˆ¶æˆ¿é—´ç¯å…‰ |
| `/clock`      | ğŸ” éœ€è¦å¯†é’¥ | è°ƒèŠ‚æ—¶é’Ÿäº®åº¦ |

## ğŸ” API å®‰å…¨è®¤è¯

### å¯†é’¥é…ç½®

åœ¨å¼€å§‹ä½¿ç”¨ API ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²åœ¨ `UserConfig.h` æ–‡ä»¶ä¸­é…ç½®äº†æ‚¨çš„ API å¯†é’¥ï¼š

```cpp
#define UserHttpApiKey "your_unique_api_key_here"
```

**é‡è¦æç¤ºï¼š**

- é»˜è®¤å¯†é’¥ä¸é…å¥—çš„å°ç¨‹åºã€Web é¡¹ç›®å¯¹åº”ï¼Œå¦‚éœ€ä¿®æ”¹è¯·åŒæ­¥æ›´æ–°
- å¦‚è‡ªå®šä¹‰å¯†é’¥ï¼Œå»ºè®®ä½¿ç”¨å­—æ¯æ•°å­—ç»„åˆï¼Œé•¿åº¦ 8 ä½ä»¥ä¸Š
- ä¸è¦å°†å¯†é’¥æ³„éœ²ç»™ä»–äºº

### ä½¿ç”¨æ–¹æ³•

å¯¹äºéœ€è¦è®¤è¯çš„æ¥å£ï¼Œåœ¨ HTTP è¯·æ±‚å¤´ä¸­åŠ å…¥ï¼š

```
X-API-Key: your_api_key_here
```

## ğŸ“¡ API æ¥å£è¯¦æƒ…

### åŸºç¡€ä¿¡æ¯

- **æœåŠ¡å™¨åœ°å€**: `http://è®¾å¤‡IPåœ°å€:ç«¯å£å·`
- **é»˜è®¤ç«¯å£**: `1229`ï¼ˆå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼‰
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

## ğŸ›ï¸ æ¥å£åˆ—è¡¨

### 1. è®¾å¤‡çŠ¶æ€æ£€æµ‹

**ç®€å•çš„åœ¨çº¿çŠ¶æ€æ£€æµ‹æ¥å£**

- **URL**: `/`
- **æ–¹æ³•**: `GET`
- **è®¤è¯**: æ— éœ€å¯†é’¥
- **å‚æ•°**: æ— 

**ç¤ºä¾‹è¯·æ±‚:**

```bash
curl http://192.168.1.100:1229/
```

**å“åº”:**

```
ä»Šæ™šçš„æœˆè‰²çœŸç¾
```

---

### 2. è·å–è®¾å¤‡çŠ¶æ€

**è·å–è®¾å¤‡å®Œæ•´çŠ¶æ€ä¿¡æ¯**

- **URL**: `/all-status`
- **æ–¹æ³•**: `GET`
- **è®¤è¯**: æ— éœ€å¯†é’¥
- **å‚æ•°**: æ— 

**ç¤ºä¾‹è¯·æ±‚:**

```bash
curl http://192.168.1.100:1229/all-status
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "errCode": 0,
  "errMsg": "è·å–æˆåŠŸ",
  "data": {
    "id": "esp8266-bedroom-01",
    "order": "RESPONSE_ALL_STATUS",
    "items": [
      {
        "type": "light",
        "id": "light-bedroom-01",
        "mark": "å§å®¤å¤§ç¯",
        "data": {
          "enable": true
        }
      },
      {
        "type": "clock",
        "id": "clock-living_room-01",
        "mark": "å®¢å…æ—¶é’Ÿ",
        "data": {
          "enable": true,
          "brightness": 5,
          "mode": 1
        }
      }
    ]
  }
}
```

---

### 3. æ§åˆ¶æˆ¿é—´ç¯å…‰

**æ§åˆ¶æˆ¿é—´ç¯å…·çš„å¼€å…³çŠ¶æ€**

- **URL**: `/room-light`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: ğŸ” **éœ€è¦ API å¯†é’¥**
- **Content-Type**: `application/json`

**è¯·æ±‚å‚æ•°:**

```json
{
  "id": "light-bedroom-01",
  "order": {
    "type": "enable",
    "value": "on" // "on" æˆ– "off"
  }
}
```

**ç¤ºä¾‹è¯·æ±‚:**

```bash
# å¼€ç¯
curl -X POST http://192.168.1.100:1229/room-light \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "light-bedroom-01",
    "order": {
      "type": "enable",
      "value": "on"
    }
  }'

# å…³ç¯
curl -X POST http://192.168.1.100:1229/room-light \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "light-bedroom-01",
    "order": {
      "type": "enable",
      "value": "off"
    }
  }'
```

**æˆåŠŸå“åº”:**

```json
{
  "errCode": 0,
  "errMsg": "æˆåŠŸ"
}
```

---

### 4. è°ƒèŠ‚æ—¶é’Ÿäº®åº¦

**è°ƒèŠ‚ LED æ˜¾ç¤ºå±çš„äº®åº¦çº§åˆ«**

- **URL**: `/clock`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: ğŸ” **éœ€è¦ API å¯†é’¥**
- **Content-Type**: `application/json`

**è¯·æ±‚å‚æ•°:**

```json
{
  "id": "clock-living_room-01",
  "order": {
    "type": "brightness",
    "value": 5 // 0-15 ä¹‹é—´çš„æ•´æ•°
  }
}
```

**äº®åº¦çº§åˆ«è¯´æ˜:**

- `0`: æœ€æš—
- `15`: æœ€äº®

**ç¤ºä¾‹è¯·æ±‚:**

```bash
# è®¾ç½®ä¸ºä¸­ç­‰äº®åº¦
curl -X POST http://192.168.1.100:1229/clock \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "clock-living_room-01",
    "order": {
      "type": "brightness",
      "value": 8
    }
  }'
```

**æˆåŠŸå“åº”:**

```json
{
  "errCode": 0,
  "errMsg": "æˆåŠŸ"
}
```

## âŒ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜       | è§£å†³æ–¹æ³•              |
| ------ | ---------- | --------------------- |
| `-1`   | é€šç”¨é”™è¯¯   | æ£€æŸ¥è¯·æ±‚å‚æ•°å’Œæ ¼å¼    |
| `401`  | è®¤è¯å¤±è´¥   | æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æ­£ç¡® |
| `404`  | æ¥å£ä¸å­˜åœ¨ | æ£€æŸ¥è¯·æ±‚è·¯å¾„æ˜¯å¦æ­£ç¡®  |

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "errCode": -1,
  "errMsg": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

### å¸¸è§é”™è¯¯ç¤ºä¾‹

**ç¼ºå°‘ API å¯†é’¥:**

```json
{
  "errCode": -1,
  "errMsg": "ç¼ºå°‘APIå¯†é’¥"
}
```

**API å¯†é’¥æ— æ•ˆ:**

```json
{
  "errCode": -1,
  "errMsg": "APIå¯†é’¥æ— æ•ˆ"
}
```

**å‚æ•°æ ¼å¼é”™è¯¯:**

```json
{
  "errCode": -1,
  "errMsg": "æ—¶é’ŸçŠ¶æ€è§£æå¤±è´¥æˆ–è®¾ç½®å€¼éæ³•"
}
```

## ğŸ§ª æµ‹è¯•å·¥å…·æ¨è

### 1. curl (å‘½ä»¤è¡Œ)

é€‚åˆè„šæœ¬è‡ªåŠ¨åŒ–å’Œå¿«é€Ÿæµ‹è¯•

```bash
curl -X POST http://è®¾å¤‡IP:1229/room-light \
  -H "X-API-Key: your_key" \
  -H "Content-Type: application/json" \
  -d '{"id":"light-bedroom-01","order":{"type":"enable","value":"on"}}'
```

### 2. Postman (å›¾å½¢ç•Œé¢)

1. æ–°å»º POST è¯·æ±‚
2. URL: `http://è®¾å¤‡IP:1229/room-light`
3. Headers æ·»åŠ :
   - `X-API-Key`: `your_api_key`
   - `Content-Type`: `application/json`
4. Body é€‰æ‹© raw/JSONï¼Œè¾“å…¥è¯·æ±‚å‚æ•°

### 3. JavaScript (ç½‘é¡µ/Node.js)

```javascript
const response = await fetch("http://è®¾å¤‡IP:1229/room-light", {
  method: "POST",
  headers: {
    "X-API-Key": "your_api_key",
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    id: "light-bedroom-01",
    order: {
      type: "enable",
      value: "on",
    },
  }),
});

const result = await response.json();
console.log(result);
```

### 4. Python

```python
import requests

url = 'http://è®¾å¤‡IP:1229/room-light'
headers = {
    'X-API-Key': 'your_api_key',
    'Content-Type': 'application/json'
}
data = {
    'id': 'light-bedroom-01',
    'order': {
        'type': 'enable',
        'value': 'on'
    }
}

response = requests.post(url, headers=headers, json=data)
print(response.json())
```

## ğŸ”§ æ•…éšœæ’é™¤

### è¿æ¥é—®é¢˜

1. **ç¡®è®¤è®¾å¤‡åœ¨çº¿**: è®¿é—® `/` æ¥å£æ£€æŸ¥è®¾å¤‡çŠ¶æ€
2. **æ£€æŸ¥ç½‘ç»œ**: ç¡®ä¿è®¾å¤‡å’Œå®¢æˆ·ç«¯åœ¨åŒä¸€ç½‘ç»œ
3. **ç«¯å£æ£€æŸ¥**: ç¡®è®¤ç«¯å£å·é…ç½®æ­£ç¡®ï¼ˆé»˜è®¤ 1229ï¼‰

### è®¤è¯é—®é¢˜

1. **æ£€æŸ¥å¯†é’¥**: ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­çš„å¯†é’¥ä¸è¯·æ±‚å¤´ä¸­çš„å¯†é’¥ä¸€è‡´
2. **è¯·æ±‚å¤´æ ¼å¼**: ç¡®ä¿ä½¿ç”¨ `X-API-Key` è€Œä¸æ˜¯å…¶ä»–åç§°
3. **å¯†é’¥å­—ç¬¦**: æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦æˆ–ç©ºæ ¼

### å‚æ•°é—®é¢˜

1. **JSON æ ¼å¼**: ä½¿ç”¨ JSON æ ¼å¼éªŒè¯å·¥å…·æ£€æŸ¥å‚æ•°æ ¼å¼
2. **å‚æ•°å€¼**: ç¡®è®¤å‚æ•°å€¼åœ¨æœ‰æ•ˆèŒƒå›´å†…
3. **Content-Type**: ç¡®ä¿è®¾ç½®äº†æ­£ç¡®çš„ Content-Type å¤´

---

**æ›´å¤šå¸®åŠ©è¯·å‚è€ƒï¼š**

- ğŸ“– [é…ç½®æ–‡ä»¶è¯´æ˜](configuration.md)
- ğŸ  [ç¡¬ä»¶æ­å»ºæŒ‡å—](hardware-setup.md)
- ğŸ’» [è½¯ä»¶é…ç½®æŒ‡å—](software-setup.md)
